<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Shortener met Tracking</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .header .info-text {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 10px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        input[type="text"] {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .result {
            display: none;
            padding: 20px;
            background: #f0f4ff;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .result.show {
            display: block;
        }

        .short-url {
            font-size: 18px;
            color: #667eea;
            word-break: break-all;
            margin: 10px 0;
            font-weight: 600;
        }

        .copy-btn {
            padding: 10px 20px;
            font-size: 14px;
            margin-top: 10px;
        }

        .links-list {
            margin-top: 30px;
        }

        .link-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }

        .link-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .original-url {
            color: #666;
            font-size: 14px;
            word-break: break-all;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }

        .visits-table {
            margin-top: 15px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .toggle-btn {
            padding: 8px 15px;
            font-size: 14px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .hidden {
            display: none;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            background: #667eea;
            color: white;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .danger-zone {
            margin-top: 30px;
            padding: 20px;
            background: #fff5f5;
            border: 2px solid #feb2b2;
            border-radius: 8px;
        }

        .danger-zone h3 {
            color: #c53030;
            margin-bottom: 10px;
        }

        .danger-zone p {
            color: #742a2a;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .delete-btn {
            background: #c53030;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .delete-btn:hover {
            background: #9b2c2c;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-content h2 {
            color: #c53030;
            margin-bottom: 15px;
        }

        .modal-content p {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-cancel {
            padding: 12px 24px;
            background: #e2e8f0;
            color: #4a5568;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-cancel:hover {
            background: #cbd5e0;
        }

        .btn-confirm {
            padding: 12px 24px;
            background: #c53030;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-confirm:hover {
            background: #9b2c2c;
        }

        .redirect-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
        }

        .redirect-screen.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }



        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .input-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="redirect-screen" id="redirectScreen">
        <div class="spinner"></div>
        <h2>Bezoek wordt geregistreerd...</h2>
        <p>Je wordt doorgestuurd naar de originele link</p>
    </div>

    <div class="container" id="mainContent">
        <div class="header">
            <h1>üîó URL Shortener</h1>
            <p>Maak verkorte links en track bezoekers</p>
            <p class="info-text">üí° Herlaad de pagina om nieuwe bezoeken te zien</p>
        </div>

        <div class="card">
            <h2>Nieuwe Link Maken</h2>
            <div class="input-group">
                <input type="text" id="urlInput" placeholder="Plak hier je lange URL...">
                <button onclick="createShortUrl()">Verkorten</button>
            </div>
            
            <div id="result" class="result">
                <p><strong>Je verkorte link:</strong></p>
                <div class="short-url" id="shortUrl"></div>
                <button class="copy-btn" onclick="copyToClipboard()">üìã Kopieer Link</button>
            </div>
        </div>

        <div class="card">
            <h2>Mijn Links Dashboard</h2>
            <div id="linksList"></div>
            
            <div class="danger-zone">
                <h3>‚ö†Ô∏è Danger Zone</h3>
                <p>Wis alle links en bezoekgeschiedenis. Deze actie kan niet ongedaan gemaakt worden!</p>
                <button class="delete-btn" onclick="showDeleteModal()">üóëÔ∏è Alles Wissen</button>
            </div>
        </div>
    </div>

    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <h2>‚ö†Ô∏è Weet je het zeker?</h2>
            <p>Je staat op het punt om <strong>ALLE links en bezoekgegevens permanent te verwijderen</strong>. Deze actie kan niet ongedaan gemaakt worden.</p>
            <p>Wil je echt doorgaan?</p>
            <div class="modal-buttons">
                <button class="btn-cancel" onclick="hideDeleteModal()">Annuleren</button>
                <button class="btn-confirm" onclick="confirmDelete()">Ja, Alles Wissen</button>
            </div>
        </div>
    </div>

    <script>
        // Gebruik localStorage voor persistente opslag
        const STORAGE_KEY = 'urlShortenerData';

        function getLinksData() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : {};
        }

        function saveLinksData(data) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        // Haal IP en browser info op
        async function getVisitorInfo() {
            const info = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                screenResolution: `${screen.width}x${screen.height}`,
                referrer: document.referrer || 'Direct'
            };

            // Probeer IP te krijgen
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                info.ip = data.ip;
            } catch (e) {
                info.ip = 'Onbekend';
            }

            return info;
        }

        // Parse browser info
        function parseBrowser(userAgent) {
            if (userAgent.includes('Firefox')) return 'Firefox';
            if (userAgent.includes('Chrome') && !userAgent.includes('Edge')) return 'Chrome';
            if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) return 'Safari';
            if (userAgent.includes('Edge')) return 'Edge';
            return 'Anders';
        }

        function parseOS(userAgent) {
            if (userAgent.includes('Windows')) return 'Windows';
            if (userAgent.includes('Mac')) return 'macOS';
            if (userAgent.includes('Linux')) return 'Linux';
            if (userAgent.includes('Android')) return 'Android';
            if (userAgent.includes('iOS')) return 'iOS';
            return 'Anders';
        }

        // Check of we een redirect moeten doen via URL parameter
        async function checkRedirect() {
            const urlParams = new URLSearchParams(window.location.search);
            const r = urlParams.get('r');
            
            if (r) {
                // Toon redirect scherm
                document.getElementById('redirectScreen').classList.add('active');
                document.getElementById('mainContent').style.display = 'none';
                
                try {
                    const decoded = atob(r);
                    
                    // Log de visit
                    const visitorInfo = await getVisitorInfo();
                    
                    const linksData = getLinksData();
                    
                    if (!linksData[r]) {
                        linksData[r] = {
                            originalUrl: decoded,
                            created: new Date().toISOString(),
                            visits: []
                        };
                    }
                    
                    linksData[r].visits.push(visitorInfo);
                    saveLinksData(linksData);
                    
                    // Redirect na 2 seconden
                    setTimeout(() => {
                        window.location.href = decoded;
                    }, 2000);
                } catch (e) {
                    alert('Ongeldige link');
                    window.location.href = window.location.origin;
                }
            }
        }

        function createShortUrl() {
            const input = document.getElementById('urlInput');
            const url = input.value.trim();
            
            if (!url) {
                alert('Voer een URL in!');
                return;
            }

            // Valideer URL
            try {
                new URL(url);
            } catch (e) {
                alert('Voer een geldige URL in (bijv. https://example.com)');
                return;
            }

            // Encode URL naar base64
            const encoded = btoa(url);
            const shortUrl = `${window.location.origin}${window.location.pathname}?r=${encoded}`;
            
            // Bewaar de link data
            const linksData = getLinksData();
            
            if (!linksData[encoded]) {
                linksData[encoded] = {
                    originalUrl: url,
                    created: new Date().toISOString(),
                    visits: []
                };
            }
            
            saveLinksData(linksData);

            // Toon resultaat
            document.getElementById('shortUrl').textContent = shortUrl;
            document.getElementById('result').classList.add('show');
            
            // Update dashboard
            updateDashboard();
            
            // Clear input
            input.value = '';
        }

        function copyToClipboard() {
            const shortUrl = document.getElementById('shortUrl').textContent;
            navigator.clipboard.writeText(shortUrl).then(() => {
                alert('Link gekopieerd naar klembord!');
            });
        }

        function updateDashboard() {
            const container = document.getElementById('linksList');
            const linksData = getLinksData();
            
            if (Object.keys(linksData).length === 0) {
                container.innerHTML = '<div class="empty-state">Nog geen links gemaakt. Maak je eerste verkorte link hierboven!</div>';
                return;
            }

            let html = '<div class="links-list">';
            
            for (const [encoded, data] of Object.entries(linksData)) {
                const shortUrl = `${window.location.origin}${window.location.pathname}?r=${encoded}`;
                const totalVisits = data.visits.length;
                const uniqueIPs = new Set(data.visits.map(v => v.ip)).size;
                
                // Browsers en OS statistieken
                const browsers = {};
                const oses = {};
                data.visits.forEach(visit => {
                    const browser = parseBrowser(visit.userAgent);
                    const os = parseOS(visit.userAgent);
                    browsers[browser] = (browsers[browser] || 0) + 1;
                    oses[os] = (oses[os] || 0) + 1;
                });

                html += `
                    <div class="link-item">
                        <div class="link-header">
                            <div>
                                <div class="short-url">${shortUrl}</div>
                                <div class="original-url">‚Üí ${data.originalUrl}</div>
                            </div>
                            <button class="toggle-btn" onclick="toggleDetails('${encoded}')">
                                Details Tonen
                            </button>
                        </div>
                        
                        <div class="stats">
                            <div class="stat-box">
                                <div class="stat-value">${totalVisits}</div>
                                <div class="stat-label">Totale Bezoeken</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value">${uniqueIPs}</div>
                                <div class="stat-label">Unieke Bezoekers</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value">${Object.keys(browsers).length}</div>
                                <div class="stat-label">Verschillende Browsers</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value">${Object.keys(oses).length}</div>
                                <div class="stat-label">Verschillende OS</div>
                            </div>
                        </div>
                        
                        <div id="details-${encoded}" class="visits-table hidden">
                            <h3 style="margin: 20px 0 10px 0;">Bezoek Details</h3>
                            ${data.visits.length > 0 ? `
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Tijd</th>
                                            <th>IP Adres</th>
                                            <th>Browser</th>
                                            <th>OS</th>
                                            <th>Scherm</th>
                                            <th>Referrer</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${data.visits.map(visit => `
                                            <tr>
                                                <td>${new Date(visit.timestamp).toLocaleString('nl-NL')}</td>
                                                <td><span class="badge">${visit.ip}</span></td>
                                                <td>${parseBrowser(visit.userAgent)}</td>
                                                <td>${parseOS(visit.userAgent)}</td>
                                                <td>${visit.screenResolution}</td>
                                                <td>${visit.referrer}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            ` : '<p style="padding: 20px; text-align: center; color: #999;">Nog geen bezoeken</p>'}
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function toggleDetails(encoded) {
            const details = document.getElementById(`details-${encoded}`);
            details.classList.toggle('hidden');
        }

        function showDeleteModal() {
            document.getElementById('deleteModal').classList.add('active');
        }

        function hideDeleteModal() {
            document.getElementById('deleteModal').classList.remove('active');
        }

        function confirmDelete() {
            // Wis alle data
            localStorage.removeItem(STORAGE_KEY);
            
            // Sluit modal
            hideDeleteModal();
            
            // Update dashboard
            updateDashboard();
            
            // Toon bevestiging
            alert('‚úÖ Alle links en geschiedenis zijn gewist!');
        }

        // Check bij laden of we een redirect moeten doen
        checkRedirect();
        
        // Update dashboard bij laden (alleen als we niet aan het redirecten zijn)
        const urlParams = new URLSearchParams(window.location.search);
        if (!urlParams.get('r')) {
            updateDashboard();
        }
    </script>
</body>
</html>
